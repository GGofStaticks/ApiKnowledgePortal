@using Blazored.LocalStorage
@using WebUI.Services
@using ApiKnowledgePortal.Application.Users.Dtos
@using ApiKnowledgePortal.Domain.Users

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Портал знаний по API</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />
<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <nav class="flex-column">
        @if (currentUser == null)
        {
			// не залогинен показываем вход и регистрацию
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="login">
                    <i class="bi bi-box-arrow-in-right me-3" style="font-size: 1.5rem; position: relative; top: -10px;"></i> Вход
                </NavLink>
            </div>
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="register">
                    <i class="bi bi-person-plus-fill me-3" style="font-size: 1.5rem; position: relative; top: -10px;"></i> Регистрация
                </NavLink>
            </div>
        }
        else
        {
			// залогинен основные разделы
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="swaggersources" Match="NavLinkMatch.Prefix">
                    <i class="bi bi-cloud-arrow-up-fill me-3" style="font-size: 1.5rem; position: relative; top: -10px;"></i> Swagger Sources
                </NavLink>
            </div>
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="apispecifications">
                    <i class="bi bi-file-earmark-code-fill me-3" style="font-size: 1.5rem; position: relative; top: -10px;"></i> API Specifications
                </NavLink>
            </div>
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="parsedapispecs">
                    <i class="bi bi-diagram-3-fill me-3" style="font-size: 1.5rem; position: relative; top: -10px;"></i> Parsed API Specs
                </NavLink>
            </div>
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="api-docs">
                    <i class="bi bi-journal-text me-3" style="font-size: 1.5rem; position: relative; top: -10px;"></i> API Документация
                </NavLink>
            </div>

			// админ панель только для админов
            @if (currentUser.Role == UserRole.Admin)
            {
                <div class="nav-item px-3">
                    <NavLink class="nav-link" href="admin/users">
                        <i class="bi bi-people-fill me-3" style="font-size: 1.5rem; position: relative; top: -10px;"></i> Админ панель
                    </NavLink>
                </div>
            }
            
            // кнопка выхода для всех залогиненных
            <div class="nav-item px-3 mt-4">
                <button class="btn btn-outline-light w-100" @onclick="Logout">
                    <i class="bi bi-box-arrow-right me-2"></i> Выйти
                </button>
            </div>
        }
    </nav>
</div>

@inject ApiClient ApiClient
@inject ILocalStorageService LocalStorage
@inject NavigationManager Navigation

@code {
    private UserDto? currentUser;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            currentUser = await ApiClient.GetCurrentUserAsync();
        }
        catch
        {
            currentUser = null;
        }
    }

    private async Task Logout()
    {
        await LocalStorage.RemoveItemAsync("authToken");
        Navigation.NavigateTo("/login", forceLoad: true);
    }
}